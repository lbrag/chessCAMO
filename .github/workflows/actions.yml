name: Unit_Testing

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  install_and_run:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2

    - name: Install GoogleTest
      run : |
          cd ../
          git clone https://github.com/google/googletest.git
          cd ./googletest/googletest/
          cmake -G "MinGW Makefiles" ..
          mingw32-make
          cd ../../ # go back to github repo directory

    - name: Compile & Link
      run: mingw32-make all_unit

    - name: Run Tests
      run: .\unit.exe --gtests_color=yes

    - name: install gcovr
      run: pip install gcovr

    - name: make code coverage report
      run: |
        gcov chess.cpp
        gcovr -r . --exclude-throw-branches --xml -o coverage.xml

    - uses: codecov/codecov-action@v1
      with:
        file: ./coverage.xml